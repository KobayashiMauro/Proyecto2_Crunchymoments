const moments = [
  //Kakashi
  {
    searchCount: '0',
    moment: 'Equipo Kakashi VS Sasori',
    anime: 'Naruto Shippuden',
    characters: [
      {
        first: 'Hatake Kakashi',
        second: 'Uzumaki Naruto',
        third: 'Sasori',
      },
    ],
    episodes: 24,
    duration: 576,
    description:
      'El equipo de Kakashi entra en acción cuando reciben la noticia de que su amigo Gaara, actual Kazekage, ha sido secuestrado por la organización Akatsuki.',
    image: 'assets/Kakashicard.jpg',
    links: [
      {
        first: 'https://www.crunchyroll.com/es-es/watch/G63VGKZNY/team-kakashi-deployed',
      },
    ],
  },
  //Carrot
  {
    searchCount: '0',
    moment: 'Sulong de Carrot',
    anime: 'One Piece',
    characters: [
      {
        first: 'Carrot',
      },
    ],
    episodes: 2,
    duration: 48,
    description: '¿Sabes cuántas veces ha entrado en acción la transformación Sulong de Carrot? ¡Compruébalo!',
    image: 'assets/Carrotcard.jpg',
    links: [
      {
        first: 'https://www.crunchyroll.com/es-es/watch/G6VD30QP6/sulong-carrots-big-mystic-transformation',
      },
    ],
  },
  //Law
  {
    searchCount: '1',
    moment: 'Law VS Kurohige',
    anime: 'One Piece',
    characters: [
      {
        first: 'Trafalgar D. Water Law',
        second: 'Kurohige Marshall D. Teach',
      },
    ],
    episodes: 2,
    duration: 48,
    description:
      'Law se enfrenta a Kurohige después de salir del país de Wano y de terminar su alianza con los Sombrero de Paja.',
    image: 'assets/Lawcard.jpg',
    links: [
      {
        first:
          'https://www.crunchyroll.com/es-es/watch/GPWUKVW2E/bonneys-lamentation-darkness-lurking-on-the-future-island',
        second: 'https://www.crunchyroll.com/es-es/watch/G8WUN19Q8/the-winner-takes-all-law-vs-blackbeard',
      },
    ],
  },
  //Tengen
  {
    searchCount: '0',
    moment: 'Tengen Uzui VS Gyutaro',
    anime: 'Kimetsu no Yaiba',
    characters: [
      {
        first: 'Tengen Uzui',
      },
    ],
    episodes: 4,
    duration: 96,
    description:
      'Cuando parecía que estaba ya todo zanjado... Daki se divide en dos demonios y ahora Uzui tiene que lidiar con su hermano mayor Gyutaro.',
    image: 'assets/Tengencard.jpg',
    links: [
      {
        first: 'https://www.crunchyroll.com/es-es/watch/G2XU03NP8/gathering',
      },
    ],
  },
  //Gojo
  {
    searchCount: '0',
    moment: 'Satoru Gojo, y ya',
    anime: 'Jujutsu Kaisen',
    characters: [
      {
        first: 'Satoru Gojo',
      },
    ],
    episodes: 7,
    duration: 168,
    description: 'No necesita mucho para lucirse, pero ¿cuántas veces ha sido el absoluto protagonista del momento?',
    image: 'assets/Gojocard.jpg',
    links: [
      {
        first: 'https://www.crunchyroll.com/es-es/watch/G64G2V2VR/for-myself',
      },
    ],
  },
  //Zoro
  {
    searchCount: '0',
    moment: 'Zoro VS King',
    anime: 'One Piece',
    characters: [
      {
        first: 'Roronoa Zoro',
      },
    ],
    episodes: 5,
    duration: 120,
    description: 'Por fin un digno rival para Zoro, una de las batallas más épicas de Wano',
    image: 'assets/Zorocard.jpg',
    links: [
      {
        first: 'https://www.crunchyroll.com/es-es/watch/GEVUZNJN3/zoro-faces-adversity---a-monster-king-the-wildfire',
      },
    ],
  },
  //Luffy
  {
    searchCount: '0',
    moment: 'Gear 5 de Luffy',
    anime: 'One Piece',
    characters: [
      {
        first: 'Monkey D. Luffy',
      },
    ],
    episodes: 3,
    duration: 72,
    description: 'Uno de los momentos más épicos y esperados de la saga',
    image: 'assets/Luffycard.jpg',
    links: [
      {
        first: 'https://www.crunchyroll.com/es-es/watch/G7PU4J9E7/luffys-peak--attained-gear-five',
      },
    ],
  },
  //Mini Law
  {
    searchCount: '0',
    moment: 'El pasado de Law',
    anime: 'One Piece',
    characters: [
      {
        first: 'Trafalgar D. Water Law',
        second: 'Donquixote Doflamingo',
        third: 'Donquixote Rosinante Corazon',
      },
    ],
    episodes: 8,
    duration: 192,
    description:
      '¡El pasado de Law se revela! La motivación de Law para acabar con Doflamingo y el recuerdo de Corazón.',
    image: 'assets/Lawminicard.png',
    links: [
      {
        first: 'https://www.crunchyroll.com/es-es/watch/G62P5G3K6/the-ultimate-power-the-secret-of-the-op-op-fruit',
        second: 'https://www.crunchyroll.com/es-es/watch/G6ZX4ENXR/sad-memories-law-the-boy-from-the-white-town',
        third: 'https://www.crunchyroll.com/es-es/watch/GYQ49DV96/a-celestial-dragon-doffys-stormy-past',
        fourth: 'https://www.crunchyroll.com/es-es/watch/GYQ49DV96/a-celestial-dragon-doffys-stormy-past',
        fifth: 'https://www.crunchyroll.com/es-es/watch/GRWEMW72R/a-rocky-road-law-and-corazons-journey-of-life',
        sixth: 'https://www.crunchyroll.com/es-es/watch/G60975NM6/the-time-is-ticking-down-seize-the-op-op-fruit',
        seventh: 'https://www.crunchyroll.com/es-es/watch/G6751XE4R/the-moment-of-resolution-corazons-farewell-smile',
        eighth: 'https://www.crunchyroll.com/es-es/watch/GYX0MGX5R/advance-law-the-kindhearted-mans-final-fight',
      },
    ],
  },
  //Sasuke
  {
    searchCount: '0',
    moment: 'Sasuke VS Itachi',
    anime: 'Naruto Shippuden',
    characters: [
      {
        first: 'Uchiha Sasuke',
        second: 'Uchiha Itachi',
      },
    ],
    episodes: 10,
    duration: 240,
    description:
      'Una pelea a muerte entre hermanos, Sasuke por fin cumple su "sueño" de vengar a su familia... ¿a qué precio?',
    image: 'assets/Sasuitacard.png',
    links: [
      {
        first: 'https://www.crunchyroll.com/es-es/watch/GRP81P8GR/banquet-invitation',
      },
    ],
  },
  //Frieren
  {
    searchCount: '0',
    moment: 'Pelea contra demonios',
    anime: 'Frieren',
    characters: [
      {
        first: 'Frieren',
        second: 'Fern',
        third: 'Stark',
      },
    ],
    episodes: 4,
    duration: 96,
    description: 'Una pelea increíble llena de magia, estrategia y fuerza ',
    image: 'assets/Frierencard.jpg',
    links: [
      {
        first: 'https://www.crunchyroll.com/es-es/watch/G4VUQ1ZKW/like-a-fairy-tale',
      },
    ],
  },
  //Osoba Mask
  {
    searchCount: '0',
    moment: 'Osoba Mask',
    anime: 'One Piece',
    characters: [
      {
        first: 'Osoba Mask Sanji Vinsmoke',
      },
    ],
    episodes: 2,
    duration: 48,
    description:
      'Aún renegando de su familia, Sanji aprovecha la pelea contra Page One para probar el traje que le ha dado el Germa 66',
    image: 'assets/Osobamaskcard.jpg',
    links: [
      {
        first: 'https://www.crunchyroll.com/es-es/watch/GY5PWQ1QY/dashing-the-righteous-soba-mask',
      },
    ],
  },
  //Rengoku
  {
    searchCount: '0',
    moment: 'Haz arder tu corazón',
    anime: 'Kimetsu no Yaiba',
    characters: [
      {
        first: 'Rengoku Pilar del fuego',
      },
    ],
    episodes: 1,
    duration: 24,
    description: 'El agrio final de una batalla tremenda',
    image: 'assets/Rengokucard.jpg',
    links: [
      {
        first: 'https://www.crunchyroll.com/es-es/watch/G0DUN0X5Z/set-your-heart-ablaze',
      },
    ],
  },
];

/* Global variables ----------------------------------------------- */
let searchButton = document.getElementById('form-simple-button');
let searchBar = document.getElementById('search-text');
let cardsContainer = document.querySelector('div.cards');
let popularContainer = document.querySelector('div.popular');
let randomContainer = document.querySelector('div.random');
let animeSelector = document.getElementById('anime-list');
let filterButton = document.querySelector('.button-go');
let filterForm = document.getElementById('form-detailed');
let resetButton = document.querySelector('.button-reset');
let notFoundText = document.querySelector('div.notFoundText');
let menuArrow = document.querySelector('arrow-menu');
/* FUNCTIONS ----------------------------------------------- */
//General
function createCards(param, container) {
  /*  container.innerHTML = ''; */
  for (const moment of param) {
    //Me traigo los datos visibles
    let momentName = document.createTextNode(moment.moment);
    let momentNameHover = document.createTextNode(moment.moment);
    let anime = document.createTextNode(moment.anime);
    let momentEps = document.createTextNode('Episodios: ' + moment.episodes);
    let momentDuration = document.createTextNode('Duración: ' + moment.duration + ' min');
    let momentDescription = document.createTextNode(moment.description);

    //Creo el contenedor de la tarjeta
    let card = document.createElement('article');
    card.classList.add('moment');

    //Creo el contenedor de la tarjeta:hover
    let cardHover = document.createElement('div');
    cardHover.classList.add('momentHover');

    //Dentro de <article> "card":
    let background = document.createElement('img');
    background.src = moment.image;
    let aImg = document.createElement('a');
    aImg.href = moment.links[0].first;
    let cardH3 = document.createElement('h3');
    let cardH4 = document.createElement('h4');

    //Dentro de <div> "cardHover":
    let backgroundHover = document.createElement('img');
    backgroundHover.src = moment.image;

    let divHoverText = document.createElement('div');
    divHoverText.classList.add('momentHover-text');
    let divHoverShadow = document.createElement('div');
    let pEps = document.createElement('p');
    let pDuration = document.createElement('p');
    let pDescription = document.createElement('p');
    let h3Hover = document.createElement('h3');

    let divHoverIcons = document.createElement('div');
    divHoverIcons.classList.add('momentHover-icons');
    let buttonPlay = document.createElement('button');
    let hoverIconPlay = document.createElement('img');
    hoverIconPlay.src = './assets/PNGNaranjaPlay.png';
    let buttonFav = document.createElement('button');
    let hoverIconFav = document.createElement('img');
    hoverIconFav.src = './assets/PNGNaranjaFav.png';
    let buttonAdd = document.createElement('button');
    let hoverIconAdd = document.createElement('img');
    hoverIconAdd.src = './assets/PNGNaranjaAdd.png';

    //Dónde lo voy a meter
    let cardsArt = card;

    //Pinto los datos
    container.appendChild(aImg); //article en div específico
    aImg.appendChild(card); //enlace imagen en article
    card.appendChild(background); //imagen en enlace imagen
    card.appendChild(cardH3); //H3 en enlace H3
    cardH3.appendChild(momentName); //Texto en H3
    card.appendChild(cardH4); //H4 en enlace H4
    cardH4.appendChild(anime); //Texto en H4

    // Pinto los datos del hover
    aImg.appendChild(cardHover); //div en enlace
    cardHover.appendChild(divHoverShadow); //div de shadow en div
    divHoverShadow.appendChild(backgroundHover); //imagen en div de shadow
    h3Hover.appendChild(momentNameHover); //nombre en h3
    cardHover.appendChild(divHoverText); // div de texto en div
    divHoverText.appendChild(h3Hover); //h3 en div de texto
    divHoverText.appendChild(pEps); //p en div de texto
    divHoverText.appendChild(pDuration); //p en div de texto
    divHoverText.appendChild(pDescription); //p en div de texto
    pEps.appendChild(momentEps); //episodios en p
    pDuration.appendChild(momentDuration); //duración en p
    pDescription.appendChild(momentDescription); //descripción en p
    cardHover.appendChild(divHoverIcons); //div de iconos en div
    divHoverIcons.appendChild(buttonPlay);
    buttonPlay.appendChild(hoverIconPlay);
    divHoverIcons.appendChild(buttonFav);
    buttonFav.appendChild(hoverIconFav);
    divHoverIcons.appendChild(buttonAdd);
    buttonAdd.appendChild(hoverIconAdd);
  }
}
//Popular
function printPopular(param) {
  moments.sort((a, b) => parseInt(b.searchCount) - parseInt(a.searchCount));
  const popularMoments = [];
  for (let i = 0; i < 6; i++) {
    popularMoments.push(moments[i]);
  }
  popularContainer.innerHTML = '';
  createCards(popularMoments, popularContainer);
}
//Explore
function printCards(param) {
  cardsContainer.innerHTML = '';
  createCards(param, cardsContainer);
}
//Random
function printRandom(param) {
  cardsContainer.innerHTML = '';
  randomContainer.innerHTML = '';
  createCards(param, randomContainer);
}
//Para crear las options de "anime-list"/selector
function animeList(param, container) {
  const uniqueAnimes = [];
  for (const moment of param) {
    if (!uniqueAnimes.includes(moment.anime)) {
      uniqueAnimes.push(moment.anime);
    }
  }
  for (const anime of uniqueAnimes) {
    let option = document.createElement('option');
    option.value = anime;
    option.textContent = anime;
    container.appendChild(option);
  }
}
//Función para crear array nuevo con elementos aleatorios
function getRandomElements(param) {
  const randomMomentsArray = [];
  while (randomMomentsArray.length < 7) {
    let randomElement = Math.floor(Math.random() * moments.length);
    if (randomMomentsArray.includes(moments[randomElement]) == false) {
      randomMomentsArray.push(moments[randomElement]);
    } else {
      continue;
    }
  }
  printRandom(randomMomentsArray);
}
// Función para aplicar todos los filtros
const applyFilters = (isSearchEvent) => {
  let searchInputText = searchBar.value.toLowerCase();
  let selectAnime = animeSelector.value;
  let episodeFilter = document.querySelector('.radio-inputs > input:checked');
  let episodeValue = episodeFilter ? episodeFilter.value : '';

  const filteredResults = moments.filter((moment) => {
    let matchesSearch =
      searchInputText === '' ||
      moment.moment.toLowerCase().includes(searchInputText) ||
      moment.anime.toLowerCase().includes(searchInputText) ||
      moment.characters.some((character) => {
        return Object.values(character).some((value) => value.toLowerCase().includes(searchInputText));
      });

    let matchesAnime = selectAnime === '' || moment.anime === selectAnime;

    let matchesEpisodes =
      episodeValue === '' ||
      (episodeValue === 'under5' && moment.episodes < 5) ||
      (episodeValue === '5to20' && moment.episodes >= 5 && moment.episodes <= 20) ||
      (episodeValue === '20to50' && moment.episodes >= 20 && moment.episodes <= 50) ||
      (episodeValue === 'more50' && moment.episodes > 50);

    return matchesSearch && matchesAnime && matchesEpisodes;
  });
  for (const moment of filteredResults) {
    let searchCounter = parseInt(moment.searchCount) || 0;
    searchCounter += 1;
    moment.searchCount = searchCounter.toString();
  }

  if (filteredResults.length === 0) {
    notFoundText.innerHTML = '';
    let notFoundPCONTAINER = document.createElement('p');
    let notFoundH3CONTAINER = document.createElement('h3');
    let notFoundPCONTENT = document.createTextNode('No se han encontrado momentos así...');
    let notFoundH3CONTENT = document.createTextNode('Échale un vistazo a estos otros momentazos');
    notFoundPCONTAINER.appendChild(notFoundPCONTENT);
    notFoundH3CONTAINER.appendChild(notFoundH3CONTENT);
    notFoundText.appendChild(notFoundPCONTAINER);
    notFoundText.appendChild(notFoundH3CONTAINER);
    getRandomElements(moments);
  } else {
    notFoundText.innerHTML = '';
    randomContainer.innerHTML = '';
    printCards(filteredResults);
  }

  printPopular(moments);
  printCards(filteredResults);
};
//Para "searchAll"/search bar
const searchAll = function searchEvent(event) {
  event.preventDefault();
  applyFilters();
};
//Para los filtros adicionales
const otherFilters = function filterEvent(event) {
  event.preventDefault();
  applyFilters();
};
// Reseteo de filtros y búsqueda
resetButton.addEventListener('click', () => {
  searchBar.value = '';
  animeSelector.value = '';
  document.querySelectorAll('input[name="episodes"]').forEach((radio) => (radio.checked = false));
  applyFilters();
});
/* FUNCTION CALLS & EVENTS --------------------------------------------- */
printCards(moments); //all
printPopular(moments);
animeList(moments, animeSelector);
searchButton.addEventListener('click', searchAll);
filterButton.addEventListener('click', otherFilters);
applyFilters();
